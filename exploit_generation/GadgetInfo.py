"""
author : 4everdestiny
create_time : 2022.12.13
description : this is the code to log the ROPgadget information
input : binary path
output : a struct contains the information of a ROPgadget
"""


class GadgetInfo:
    def __init__(self, address=0, instructions=[], _type="pop"):
        self.address = address
        self.instructions = instructions
        self._type = _type
        self.affected_regs = self.parseaffectedregs()
        self.gadget_source = "ROPgadget"

    def compare(self, instructions):
        if len(self.instructions) != len(instructions):
            return False
        for i in range(len(self.instructions)):
            if self.instructions[i] != instructions[i]:
                return False
        return True

    def contain(self, instruction):
        if instruction in self.instructions:
            return True
        return False

    def parseaffectedregs(self):
        if self._type != "pop":
            return []
        else:
            affected_regs = []
            for instruction in self.instructions:
                if instruction[:3] == "pop":
                    affected_regs.append(instruction.split(" ")[-1])
            return affected_regs
